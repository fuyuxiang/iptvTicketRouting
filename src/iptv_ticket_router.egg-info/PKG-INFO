Metadata-Version: 2.4
Name: iptv-ticket-router
Version: 1.0.0
Summary: IPTV customer-service ticket classification and auto-routing service (carrier-grade)
Author-email: Your Company <support@example.com>
License: Apache-2.0
Keywords: iptv,ticket,routing,nlp,fastapi
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi>=0.110
Requires-Dist: uvicorn[standard]>=0.27
Requires-Dist: gunicorn>=21.2
Requires-Dist: pydantic>=2.6
Requires-Dist: pyyaml>=6.0.1
Requires-Dist: scikit-learn>=1.4
Requires-Dist: joblib>=1.3
Requires-Dist: jieba>=0.42.1
Requires-Dist: prometheus-client>=0.20.0
Requires-Dist: python-json-logger>=2.0.7
Provides-Extra: train
Requires-Dist: pandas>=2.1; extra == "train"
Provides-Extra: test
Requires-Dist: pytest>=8.0; extra == "test"
Requires-Dist: httpx>=0.27; extra == "test"

# IPTV 工单自动分类与分流（2025 工程化可交付版本）

面向运营商 IPTV 客服场景：对工单文本做**自动分类（故障大类）**，并基于分类结果做**自动分流（映射到分配部门/队列）**，降低人工初筛成本。

本项目提供：
- 训练：`scripts/train.py`（可用你们的数据重新训练并生成映射）
- 在线：FastAPI 服务（/predict、/healthz、/metrics）
- 运维：结构化日志、Prometheus 指标、Docker 生产部署模板

---

## 1) 快速开始

### 1.1 本地运行（开发）

```bash
python -m venv .venv && source .venv/bin/activate
pip install -U pip
pip install -e "..[train,test]"  # 或 pip install -e ".[train,test]"

# 训练（会产出 models/ticket_clf.joblib + label/route 映射）
python scripts/train.py --config configs/config.yaml

# 启动服务
export IPTV_CONFIG=configs/config.yaml
iptv-ticket-router serve --host 0.0.0.0 --port 8080
```

请求示例：
```bash
curl -s http://localhost:8080/healthz

curl -s http://localhost:8080/predict \
  -H 'content-type: application/json' \
  -d '{"ticket_id":"IPTV-001","text":"机顶盒提示网络异常，无法播放"}' | jq
```

### 1.2 生产部署（Docker）

```bash
docker build -t iptv-ticket-router:1.0.0 .
docker run --rm -p 8080:8080 -e IPTV_CONFIG=/app/configs/config.yaml iptv-ticket-router:1.0.0
```

---

## 2) API

- `GET /healthz`：健康检查
- `GET /metrics`：Prometheus 指标
- `POST /predict`：分类 + 分流

请求：
```json
{
  "ticket_id": "IPTV-xxx",
  "text": "机顶盒一直提示网络异常，无法播放"
}
```

响应（示例）：
```json
{
  "ticket_id": "IPTV-xxx",
  "label": "网络异常",
  "confidence": 0.83,
  "dept": "区域装维团队",
  "queue": "QUEUE_FIELD",
  "auto_routed": true,
  "model_version": "2025.12",
  "latency_ms": 4.1
}
```

说明：
- `auto_routed`：当 `confidence >= threshold_auto_route` 时自动分流，否则进入默认队列（转人工）

---

## 3) 配置

配置文件：`configs/config.yaml`，支持用 `IPTV_CONFIG` 环境变量指定。

你们最常改的是：
- `routing.route_map_file` / `routing.dept_to_queue`：部门/队列映射
- `model.threshold_auto_route`：自动分流阈值

---

## 4) 交付建议（运营商环境）

- 将 `models/` 作为制品仓库（Model Registry）落盘管理：包含 joblib、label/route 映射、`model_meta.json`
- 在灰度期把 `auto_routed=false` 的样本回流到标注队列，用于二次训练与映射校准
- 队列映射建议**按地市/区域拆分**（route_map 可支持多租户/多地域配置）

